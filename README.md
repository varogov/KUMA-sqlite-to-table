# KUMA Accounts Export & Dictionary Update

–°–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è:

1.  –≠–∫—Å–ø–æ—Ä—Ç–∞ —É—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–π SQLite-–±–∞–∑—ã **Kaspersky
    Unified Monitoring and Analysis Platform (KUMA)**\
2.  –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è CSV-—Ñ–∞–π–ª–∞\
3.  –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —ç—Ç–æ–≥–æ CSV –≤ —Å–ª–æ–≤–∞—Ä—å KUMA —á–µ—Ä–µ–∑ REST API

------------------------------------------------------------------------

## üìå –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

-   –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ KUMA –≤ —Ä–µ–∂–∏–º–µ *read-only*
-   –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—É—Å—Ç—ã—Ö –∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
-   –≠–∫—Å–ø–æ—Ä—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
-   –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–ª–æ–≤–∞—Ä—å KUMA
-   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ CSV –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
-   –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ —Ä–∞–±–æ—Ç—ã

------------------------------------------------------------------------

## üìÇ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç

### 1Ô∏è‚É£ –≠–∫—Å–ø–æ—Ä—Ç –∏–∑ SQLite

–ò–∑ —Ç–∞–±–ª–∏—Ü—ã `accounts` –≤—ã–±–∏—Ä–∞—é—Ç—Å—è –ø–æ–ª—è:

  –ü–æ–ª–µ –≤ –ë–î      –ü–æ–ª–µ –≤ CSV
  -------------- ------------
  object_sid     SID
  display_name   userName
  domain         domainName

–§–∏–ª—å—Ç—Ä—É—é—Ç—Å—è –∑–∞–ø–∏—Å–∏:

-   –ø—É—Å—Ç—ã–µ SID
-   –ø—É—Å—Ç—ã–µ –∏–º–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
-   –ø—É—Å—Ç—ã–µ –¥–æ–º–µ–Ω—ã

–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª:

    kuma_export.csv

------------------------------------------------------------------------

### 2Ô∏è‚É£ –û—Ç–ø—Ä–∞–≤–∫–∞ CSV –≤ KUMA

CSV –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ API:

    POST /api/v3/dictionaries/update

–° –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –ø–æ Bearer Token.

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è.

------------------------------------------------------------------------

## ‚öô –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ü–û

-   Python 3.7+
-   –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä—É KUMA
-   –õ–æ–∫–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ SQLite –±–∞–∑–µ KUMA

### Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∏

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

    pip install requests

(–º–æ–¥—É–ª–∏ `sqlite3`, `csv`, `os`, `logging` –≤—Ö–æ–¥—è—Ç –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é
–±–∏–±–ª–∏–æ—Ç–µ–∫—É Python)

------------------------------------------------------------------------

## üõ† –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1Ô∏è‚É£ –ü—É—Ç—å –∫ –±–∞–∑–µ KUMA

    DB_PATH = "/opt/kaspersky/kuma/core/.../raft/sm/db"

### 2Ô∏è‚É£ –ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ KUMA

    URL = "https://KUMA_IP:7223/api/v3/dictionaries/update"

–ü—Ä–∏–º–µ—Ä:

    URL = "https://10.10.10.5:7223/api/v3/dictionaries/update"

------------------------------------------------------------------------

### 3Ô∏è‚É£ ID —Å–ª–æ–≤–∞—Ä—è

    DICTIONARY_ID = "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"

------------------------------------------------------------------------

### 4Ô∏è‚É£ API Token

    TOKEN = "YOUR_API_TOKEN"

------------------------------------------------------------------------

## ‚ñ∂ –ó–∞–ø—É—Å–∫

    python3 sqlite_to_table.py

------------------------------------------------------------------------

## ‚ö† –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### SSL

–í –∫–æ–¥–µ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞:

    verify=False

–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production –æ–∫—Ä—É–∂–µ–Ω–∏–π.

------------------------------------------------------------------------

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ API —Ç–æ–∫–µ–Ω –≤ –ø—É–±–ª–∏—á–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ `.env` —Ñ–∞–π–ª—ã.

------------------------------------------------------------------------

## ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:

-   Kaspersky KUMA 3.x
-   Python 3.8+
